(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const u of r.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function e(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=e(i);fetch(i.href,r)}})();(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))e(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&e(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function e(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();class o{x;y;constructor(t,e){this.x=t,this.y=e}static TOP_LEFT=new o(0,0);static TOP_CENTER=new o(.5,0);static TOP_RIGHT=new o(1,0);static MIDDLE_LEFT=new o(0,.5);static MIDDLE_CENTER=new o(.5,.5);static MIDDLE_RIGHT=new o(1,.5);static BOTTOM_LEFT=new o(0,1);static BOTTOM_CENTER=new o(.5,1);static BOTTOM_RIGHT=new o(1,1);static CENTER=new o(.5,.5);static ZERO=new o(0,0);static ONE=new o(1,1)}class a{position;pivot;gOffset;constructor(t,e,s=o.ZERO){this.position=t,this.pivot=e,this.gOffset=s}static TOP_LEFT=new a(o.TOP_LEFT,o.TOP_LEFT);static TOP_CENTER=new a(o.TOP_CENTER,o.TOP_CENTER);static TOP_RIGHT=new a(o.TOP_RIGHT,o.TOP_RIGHT);static MIDDLE_LEFT=new a(o.MIDDLE_LEFT,o.MIDDLE_LEFT);static MIDDLE_CENTER=new a(o.MIDDLE_CENTER,o.MIDDLE_CENTER);static MIDDLE_RIGHT=new a(o.MIDDLE_RIGHT,o.MIDDLE_RIGHT);static BOTTOM_LEFT=new a(o.BOTTOM_LEFT,o.BOTTOM_LEFT);static BOTTOM_CENTER=new a(o.BOTTOM_CENTER,o.BOTTOM_CENTER);static BOTTOM_RIGHT=new a(o.BOTTOM_RIGHT,o.BOTTOM_RIGHT)}function l(n){n||console.error("Assertion failed!")}const C=1024;class R{x;y;width;height;scale;constructor(t,e,s,i,r){this.x=t,this.y=e,this.width=s,this.height=i,this.scale=r}unit(t){return t*this.scale/C}}let I=0;class S{ID;refresh(){}constructor(){this.ID=++I}}class O extends S{destroyed=!1;parent;pxSizeX;pxSizeY;z;constructor(){super(),this.pxSizeX=1,this.pxSizeY=1,this.z=-1}setZ(t){l(this.z==-1),this.z=t}setParent(t){this.parent=t}updateSizeRef(t,e,s){this.pxSizeX=t.unit(e),this.pxSizeY=t.unit(s)}calculateTopLeft(t,e){l(this.z!=-1);const s=t.x+e.position.x*t.width,i=t.y+e.position.y*t.height;let r=s+t.unit(e.gOffset.x),u=i+t.unit(e.gOffset.y);return r-=e.pivot.x*this.pxSizeX,u-=e.pivot.y*this.pxSizeY,new o(r,u)}update(t){}destroy(){this.destroyed=!0}isDestroyed(){return this.destroyed}react(t,e){}}class x extends O{refX;refY;constructor(t,e=""){super(),this.refX=t.x,this.refY=t.y;const s=document.createElement("div");e!=""&&(s.className=e),s.style.position="absolute",document.body.append(s),this.element=s}setSize(t){this.refX=t.x,this.refY=t.y}updateSize(t){this.updateSizeRef(t,this.refX,this.refY);const e=this.element.style;e.width=this.pxSizeX+"px",e.height=this.pxSizeY+"px"}updatePosition(t,e){const s=this.calculateTopLeft(t,e);this.setTopLeft(s.x,s.y)}setTopLeft(t,e){const s=this.element.style;s.left=t+"px",s.top=e+"px",s.zIndex=this.z.toString()}destroy(){super.destroy(),this.element.remove()}}class h{static SCENE_ZBASE=1e6;static POPUP_ZBASE=2e6;zBase;update(t){}constructor(t){this.zBase=t}}class z{obj;key;constructor(t,e){this.obj=t,this.key=e}}class v{values={};listeners=[];set(t,e){if(!Object.is(this.values[t],e)){this.values[t]=e,this.listeners=this.listeners.filter(s=>!s.obj.isDestroyed());for(const s of this.listeners)s.key===t&&s.obj.react(t,e)}}add(t,e){this.listeners.push(new z(t,e))}}class b{roots=[];reactor;constructor(){this.reactor=new v}resize(t,e){for(const s of this.roots)s.updateLayout(new R(0,0,t,e,e))}createRoot(t){let e=new M(t);return this.roots.push(e),e}lastUpdate=0;STEP=1e3/20;update(t){}loop=t=>{if(t-this.lastUpdate>=this.STEP){const e=t-this.lastUpdate;this.lastUpdate=t,this.update(e);for(const s of this.roots)s.update(e)}requestAnimationFrame(this.loop)};start(){this.lastUpdate=performance.now(),requestAnimationFrame(this.loop)}}class A{pos;obj;constructor(t,e){this.pos=t,this.obj=e}}class D{zBase;parent;children=[];constructor(t,e){this.zBase=t,this.parent=e}add(t,e){t.setParent(this.parent),this.children.push(new A(e,t)),t.setZ(this.zBase+this.children.length)}removeAll(){for(const t of this.children)t.obj.destroy();this.children=[]}}class M extends S{box;refreshLayoutOnNextUpdate=!1;collection;constructor(t){super(),this.collection=new D(t,this)}updateLayout(t){this.box=t,this.refreshLayoutOnNextUpdate=!0}add(t,e){this.collection.add(t,e)}update(t){if(this.refreshLayoutOnNextUpdate&&this.box){for(const e of this.collection.children)e.obj.updateSize(this.box),e.obj.updatePosition(this.box,e.pos);this.refreshLayoutOnNextUpdate=!1}for(const e of this.collection.children)e.obj.update(t)}refresh(){this.refreshLayoutOnNextUpdate=!0}removeAll(){this.collection.removeAll()}}class c extends O{static HORIZONTAL=1001;static VERTICAL=1002;static ALIGN_FRONT=2001;static ALIGN_BACK=2002;static ALIGN_CENTER=2003;orientation;alignment;children=[];constructor(t=c.VERTICAL,e=c.ALIGN_CENTER){super(),this.orientation=t,this.alignment=e}add(t){l(this.z!=-1),t.setParent(this),this.children.push(t),t.setZ(this.z+this.children.length)}updateSize(t){let e=0,s=0;for(const i of this.children)i.updateSize(t),this.orientation==c.VERTICAL?(s+=i.pxSizeY,e=Math.max(e,i.pxSizeX)):this.orientation==c.HORIZONTAL?(e+=i.pxSizeX,s=Math.max(s,i.pxSizeY)):l(!1);this.pxSizeX=e,this.pxSizeY=s}updatePosition(t,e){const s=this.calculateTopLeft(t,e);this.setTopLeft(s.x,s.y)}setTopLeft(t,e){let s=t,i=e;for(const r of this.children)this.orientation==c.VERTICAL?(this.alignment==c.ALIGN_FRONT?r.setTopLeft(s,i):this.alignment==c.ALIGN_BACK?r.setTopLeft(s+this.pxSizeX-r.pxSizeX,i):this.alignment==c.ALIGN_CENTER?r.setTopLeft(s+(this.pxSizeX-r.pxSizeX)/2,i):l(!1),i+=r.pxSizeY):this.orientation==c.HORIZONTAL?(r.setTopLeft(s,i),s+=r.pxSizeX):l(!1)}update(t){this.children=this.children.filter(e=>!e.isDestroyed());for(const e of this.children)e.update(t)}refresh(){this.parent?.refresh()}destroy(){for(const t of this.children)t.destroy();this.children=[]}}const B=new o(400,50);class G extends x{constructor(t,e){super(e);const s=document.createElement("img");s.src=L(t),s.style.width="100%",s.style.height="100%",s.style.objectFit="cover",this.element.appendChild(s)}}class d extends x{constructor(t,e){super(e,"dtext"),this.element.textContent=t}react(t,e){this.element.textContent=e}}class T extends x{action;vanishing;vanishTime=2e3;clickHandler;constructor(t,e,s=B){super(s,"dbutton"),this.vanishing=!1,this.action=e,this.element.textContent=t,this.clickHandler=()=>{this.action()},this.element.addEventListener("click",this.clickHandler)}vanish(){this.vanishing=!0,this.element.removeEventListener("click",this.clickHandler)}update(t){this.vanishing&&(this.refY*=.9,this.vanishTime-=t,this.vanishTime<=0&&this.destroy(),this.parent?.refresh(),console.log("vanishing "+t+" pxy"+this.pxSizeY))}setAction(t){this.action=t}}class _ extends h{root;game;constructor(t){super(h.SCENE_ZBASE),this.game=t,this.root=t.sceneContainer}init(){const t=new c;this.root.add(t,a.MIDDLE_CENTER),t.add(new d("loading...",new o(200,50)))}uninit(){}}const y=new Map;let m=[];async function H(n){const t=(n||"en").toLowerCase();for(const r of m)y.delete(r);m=[];const e=L(`i18n/${t}.json`),s=await fetch(e);if(!s.ok)throw new Error(`i18n load failed: ${s.status} ${s.statusText}`);console.log(`language loaded: ${n}`);const i=await s.json();P(i)}function f(n,t,e){return y.get(n)??e??n}function P(n,t){for(const[e,s]of Object.entries(n)){const i=t?`${t}.${e}`:e;typeof s=="string"?(y.set(i,s),m.push(i)):F(s)&&P(s,i)}}function F(n){return!!n&&typeof n=="object"&&!Array.isArray(n)}let w;const j=new Map;async function Y(n){const t=await fetch(n);if(!t.ok)throw new Error(`Failed to load catalog: ${t.status} ${t.statusText}`);const e=await t.json();w=e,$(e),j.clear()}function X(n){const t=U();for(const e of t.areas){const s=e.topics.find(i=>i.id===n);if(s)return s}throw new Error(`Topic not found: ${n}`)}function Z(n){return X(n).subtopics}function U(){if(!w)throw new Error("QuestionManager.init must be called before using the catalog");return w}function $(n){const t=new Set;for(const e of n.areas)for(const s of e.topics)for(const i of s.subtopics)for(const r of i.exercise)t.add(r.id);return t}class k extends h{root;game;constructor(t){super(h.SCENE_ZBASE),this.game=t,this.root=t.sceneContainer}init(){const t=new c;this.root.add(t,a.MIDDLE_CENTER),t.add(new G("icons/title.png",new o(300,300))),t.add(new d("Dolfin Math Practice",new o(200,50))),t.add(new T(f("menu.start"),()=>this.goSubTopics()))}uninit(){}goSubTopics(){const t=this.root;t.removeAll();const e=new c;this.root.add(e,a.MIDDLE_CENTER),e.add(new d(f("menu.subtopicsTitle"),new o(200,50)));const s=Z("measurement");console.log(s.length);for(const i of s)e.add(new T(i.name,()=>this.goExercises(i)));t.refresh()}goExercises(t){const e=this.root;e.removeAll();const s=new c;this.root.add(s,a.MIDDLE_CENTER),s.add(new d(f(t.name),new o(200,50))),console.log(t.exercise.length);for(const i of t.exercise)s.add(new T(f(`exercise.${i.id}.title`),()=>this.startExercise(i)));e.refresh()}startExercise(t){console.log(`start ${t.id}`)}}class p{static STORAGE_KEY="playerSettings";language="en";stats={};constructor(t){t?.language&&(this.language=t.language.toLowerCase()),t?.stats&&typeof t.stats=="object"&&(this.stats={...t.stats})}static loadFromStorage(){try{const t=localStorage.getItem(p.STORAGE_KEY);if(!t)return new p;const e=JSON.parse(t);return new p(e)}catch{return new p}}toJSON(){return{language:this.language,stats:this.stats}}save(){E.reactor.set("playerSettings",this),E.reactor.set("language",this.language);try{localStorage.setItem(p.STORAGE_KEY,JSON.stringify(this.toJSON()))}catch{}}setLanguage(t){this.language=(t||"en").toLowerCase(),this.save()}setExerciseSuccess(t,e){const s=Math.max(0,Math.min(1,Number(e))),i=`x:${t}`,r=this.stats[i];(r===void 0||s>r)&&(this.stats[i]=s,this.save())}}class K extends h{root;game;done;constructor(t){super(h.SCENE_ZBASE),this.game=t,this.root=t.sceneContainer,this.done=!1}init(){const t=new c;this.root.add(t,a.MIDDLE_CENTER),t.add(new d(". . .",new o(200,50)));const e=L("question_catalog.json"),s=p.loadFromStorage();s.save(),this.done=!1,Promise.all([Y(e),H(s.language).catch(i=>{console.warn("i18n load failed",i)})]).then(()=>q(this)).catch(i=>console.error(i))}update(t){this.done&&this.game.loadScene(this.game.mainMenu)}uninit(){}}function q(n){n.done=!0,console.log(f("menu.start"))}class J extends h{root;game;constructor(t){super(h.POPUP_ZBASE),this.game=t,this.root=t.popupContainer}init(){const t=new c;this.root.add(t,a.MIDDLE_CENTER),t.add(new d("Settings",new o(200,50)))}uninit(){}}class V extends b{nextScene=void 0;nextPopup=void 0;scene;popup=void 0;sceneContainer;popupContainer;popupBG;mainMenu;loading;boot;settings;constructor(){super(),this.sceneContainer=this.createRoot(h.SCENE_ZBASE),this.popupContainer=this.createRoot(h.POPUP_ZBASE),this.popupBG=Q(h.POPUP_ZBASE-1,()=>W(this)),this.hidePopupBG(),this.mainMenu=new k(this),this.loading=new _(this),this.boot=new K(this),this.settings=new J(this),this.scene=this.boot}update(t){this.nextScene?(this.scene.uninit(),this.scene=this.nextScene,this.nextScene=void 0,this.cleanupScene(),this.scene.init(),this.sceneContainer.refresh()):this.nextPopup?(this.popup&&(this.popup.uninit(),this.cleanupPopup()),this.popup=this.nextPopup,this.nextPopup=void 0,this.popup.init(),this.showPopupBG(),this.popupContainer.refresh()):(this.scene.update(t),this.popup&&this.popup.update(t))}hidePopupBG(){this.popupBG.style.display="none"}showPopupBG(){this.popupBG.style.display=""}closePopup(){this.popup&&(this.popup.uninit(),this.popup=void 0,this.cleanupPopup(),this.hidePopupBG())}cleanupScene(){this.sceneContainer.removeAll()}cleanupPopup(){this.popupContainer.removeAll()}loadScene(t){l(!this.nextScene&&!this.nextPopup),this.nextScene=t}loadPopup(t){l(!this.nextScene&&!this.nextPopup),this.nextPopup=t}resize(t,e){const s=window.innerHeight/1024;document.documentElement.style.setProperty("--one",s+"px"),super.resize(t,e)}}function W(n){console.log("pop-up BG pressed"),n.popup&&n.closePopup()}function Q(n,t){const e=document.createElement("div");return Object.assign(e.style,{position:"fixed",inset:"0",background:"rgba(0,0,0,0.5)",zIndex:String(n),pointerEvents:"auto"}),e.addEventListener("pointerdown",s=>{s.preventDefault(),s.stopPropagation(),t?.(s)}),document.body.appendChild(e),e}const g=document.querySelector("#app");if(!g)throw new Error("Unable to find the root #app element.");g.classList.add("app-root");const E=new V;E.scene.init();function L(n){const t=`${window.location.pathname.split("/").filter(Boolean)[0]||""}/assets/${n}`;return console.log(`path: ${t}`),t}const N=()=>{E.resize(g.clientWidth||window.innerWidth,g.clientHeight||window.innerHeight)};window.addEventListener("resize",N);N();E.start();
